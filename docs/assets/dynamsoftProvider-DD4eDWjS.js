var Kt=Object.defineProperty;var qt=(e,t,s)=>t in e?Kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Oe=(e,t,s)=>qt(e,typeof t!="symbol"?t+"":t,s);import{l as de}from"./index-D_IN8Pdh.js";/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.31
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */const Qe=e=>e&&typeof e=="object"&&typeof e.then=="function",Je=(async()=>{})().constructor;class Ge extends Je{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let s;this._task=t,Qe(t)?s=t:typeof t=="function"&&(s=new Je(t)),s&&(async()=>{try{const i=await s;t===this._task&&this.resolve(i)}catch(i){t===this._task&&this.reject(i)}})()}get isEmpty(){return this._task==null}constructor(t){let s,i;super((r,n)=>{s=r,i=n}),this._s="pending",this.resolve=r=>{this.isPending&&(Qe(r)?this.task=r:(this._s="fulfilled",s(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",i(r))},this.task=t}}var ze,ne,Ce;typeof SuppressedError=="function"&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(ze||(ze={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(ne||(ne={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(Ce||(Ce={}));const Te=typeof self>"u",vt=typeof importScripts=="function",Ke=(()=>{if(!vt){if(!Te&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),yt=e=>{if(e==null&&(e="./"),!(Te||vt)){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},fe=e=>typeof e=="number"&&!Number.isNaN(e),wt=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),es=e=>!!wt(e)&&!!fe(e.width)&&!(e.width<=0)&&!!fe(e.height)&&!(e.height<=0)&&!!fe(e.stride)&&!(e.stride<=0)&&"format"in e&&!("tag"in e&&!ss(e.tag)),ts=e=>!!es(e)&&e.bytes instanceof Uint8Array,ss=e=>e===null||!!wt(e)&&!!fe(e.imageId)&&"type"in e,qe=async(e,t)=>await new Promise((s,i)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType=t,r.send(),r.onloadend=async()=>{r.status<200||r.status>=300?i(new Error(e+" "+r.status)):s(r.response)},r.onerror=()=>{i(new Error("Network Error: "+r.statusText))}}),te=(e,t)=>{let s=e.split("."),i=t.split(".");for(let r=0;r<s.length&&r<i.length;++r){let n=s[r],a=i[r];if(n===a)continue;let E=parseInt(s[r]),o=parseInt(i[r]);return E===o||Number.isNaN(E)&&Number.isNaN(o)?n<a?-1:1:E<o||Number.isNaN(E)&&Number.isInteger(o)?-1:1}return s.length===i.length?0:s.length<i.length?-1:1},he=e=>{const t={},s={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer",ddv:"dynamsoft-document-viewer"};for(let i in e){if(i==="rootDirectory")continue;let r=i,n=e[r],a=n&&typeof n=="object"&&n.path?n.path:n,E=e.rootDirectory;if(E&&!E.endsWith("/")&&(E+="/"),typeof n=="object"&&n.isInternal)E&&(a=e[r].version?`${E}${s[r]}@${e[r].version}/dist/${r==="ddv"?"engine":""}`:`${E}${s[r]}/dist/${r==="ddv"?"engine":""}`);else{const o=/^@engineRootDirectory(\/?)/;if(typeof a=="string"&&(a=a.replace(o,E||"")),typeof a=="object"&&r==="dwt"){const l=e[r].resourcesPath,I=e[r].serviceInstallerLocation;t[r]={resourcesPath:l.replace(o,E||""),serviceInstallerLocation:I.replace(o,E||"")};continue}}t[r]=yt(a)}return t};let oe,Z,ue,ge,B;typeof navigator<"u"&&(oe=navigator,Z=oe.userAgent,ue=oe.platform,ge=oe.mediaDevices),function(){if(!Te){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:oe.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ue,search:"Win"},Mac:{str:ue},Linux:{str:ue}};let s="unknownBrowser",i=0,r="unknownOS";for(let n in e){const a=e[n]||{};let E=a.str||Z,o=a.search||n,l=a.verStr||Z,I=a.verSearch||n;if(I instanceof Array||(I=[I]),E.indexOf(o)!=-1){s=n;for(let g of I){let L=l.indexOf(g);if(L!=-1){i=parseFloat(l.substring(L+g.length+1));break}}break}}for(let n in t){const a=t[n]||{};let E=a.str||Z,o=a.search||n;if(E.indexOf(o)!=-1){r=n;break}}r=="Linux"&&Z.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),B={browser:s,version:i,OS:r}}Te&&(B={browser:"ssr",version:0,OS:"ssr"})}();const is=typeof WebAssembly<"u"&&Z&&!(/Safari/.test(Z)&&!/Chrome/.test(Z)&&/\(.+\s11_2_([2-6]).*\)/.test(Z)),rs=!(typeof Worker>"u"),Ft=!(!ge||!ge.getUserMedia),ns=async()=>{let e=!1;if(Ft)try{(await ge.getUserMedia({video:!0})).getTracks().forEach(t=>{t.stop()}),e=!0}catch{}return e};B.browser==="Chrome"&&B.version>66||B.browser==="Safari"&&B.version>13||B.browser==="OPR"&&B.version>43||B.browser==="Edge"&&B.version;const X={},Ue=async e=>{let t=typeof e=="string"?[e]:e,s=[];for(let i of t)s.push(X[i]=X[i]||new Ge);await Promise.all(s)},Ve=async(e,t)=>{let s,i=typeof e=="string"?[e]:e,r=[];for(let n of i){let a;r.push(a=X[n]=X[n]||new Ge(s=s||t())),a.isEmpty&&(a.task=s=s||t())}await Promise.all(r)};let f,Bt=0;const N=()=>Bt++,h={};let J;const as=e=>{J=e,f&&f.postMessage({type:"setBLog",body:{value:!!e}})};let xe=!1;const os=e=>{xe=e,f&&f.postMessage({type:"setBDebug",body:{value:!!e}})},q={},P={},ee={dip:{wasm:!0}},ke={std:{version:"1.4.21",path:yt(Ke+"../../dynamsoft-capture-vision-std@1.4.21/dist/"),isInternal:!0},core:{version:"3.4.31",path:Ke,isInternal:!0}},j=async e=>{let t;e instanceof Array||(e=e?[e]:[]);let s=X.core;t=!s||s.isEmpty;let i=new Map;const r=E=>{if((E=E.toLowerCase())=="std"||E=="core")return;if(!ee[E])throw Error("The '"+E+"' module cannot be found.");let o=ee[E].deps;if(o!=null&&o.length)for(let I of o)r(I);let l=X[E];i.has(E)||i.set(E,!l||l.isEmpty)};for(let E of e)r(E);let n=[];t&&n.push("core"),n.push(...i.keys());const a=[...i.entries()].filter(E=>!E[1]).map(E=>E[0]);await Ve(n,async()=>{const E=[...i.entries()].filter(T=>T[1]).map(T=>T[0]);await Ue(a);const o=he(ke),l={};for(let T of E)l[T]=ee[T];const I={engineResourcePaths:o,autoResources:l,names:E};let g=new Ge;if(t){I.needLoadCore=!0;let T=o.core+d._workerName;T.startsWith(location.origin)||(T=await fetch(T).then(_=>_.blob()).then(_=>URL.createObjectURL(_))),f=new Worker(T),f.onerror=_=>{let u=new Error(_.message);g.reject(u)},f.addEventListener("message",_=>{let u=_.data?_.data:_,U=u.type,D=u.id,O=u.body;switch(U){case"log":J&&J(u.message);break;case"task":try{h[D](O),delete h[D]}catch(y){throw delete h[D],y}break;case"event":try{h[D](O)}catch(y){throw y}break;default:console.log(_)}}),I.bLog=!!J,I.bd=xe,I.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await Ue("core");let L=Bt++;h[L]=T=>{if(T.success)Object.assign(q,T.versions),JSON.stringify(T.versions)!=="{}"&&(d._versions=T.versions),g.resolve(void 0);else{const _=Error(T.message);T.stack&&(_.stack=T.stack),g.reject(_)}},f.postMessage({type:"loadWasm",body:I,id:L}),await g})};class d{static get engineResourcePaths(){return ke}static set engineResourcePaths(t){Object.assign(ke,t)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return J}static set _onLog(t){as(t)}static get _bDebug(){return xe}static set _bDebug(t){os(t)}static isModuleLoaded(t){return t=(t=t||"core").toLowerCase(),!!X[t]&&X[t].isFulfilled}static async loadWasm(t){return await j(t)}static async detectEnvironment(){return await(async()=>({wasm:is,worker:rs,getUserMedia:Ft,camera:await ns(),browser:B.browser,version:B.version,OS:B.OS}))()}static async getModuleVersion(){return await new Promise((t,s)=>{let i=N();h[i]=async r=>{if(r.success)return t(r.versions);{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,s(n)}},f.postMessage({type:"getModuleVersion",id:i})})}static getVersion(){const t=q.core&&q.core.worker,s=q.core&&q.core.wasm;return`3.4.31(Worker: ${t||"Not Loaded"}, Wasm: ${s||"Not Loaded"})`}static enableLogging(){d._onLog=console.log}static disableLogging(){d._onLog=null}static async cfd(t){return await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s();{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cfd",id:r,body:{count:t}})})}}var S,et,tt,st,it,rt,nt,at,ot;d._bSupportDce4Module=-1,d._bSupportIRTModule=-1,d._versions=null,d._workerName="core.worker.js",d.browserInfo=B,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(S||(S={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(et||(et={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",e[e.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",e[e.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",e[e.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",e[e.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",e[e.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",e[e.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",e[e.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",e[e.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",e[e.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",e[e.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",e[e.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",e[e.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",e[e.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",e[e.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",e[e.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",e[e.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",e[e.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",e[e.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",e[e.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",e[e.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",e[e.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",e[e.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(tt||(tt={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV"}(st||(st={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV"}(it||(it={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(rt||(rt={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(nt||(nt={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(at||(at={})),function(e){e[e.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",e[e.CVS_PASSED=1]="CVS_PASSED",e[e.CVS_FAILED=2]="CVS_FAILED"}(ot||(ot={}));BigInt(0),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19),BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt(1<<29),BigInt("0xFFFFFFFFFFFFFFFF");var Et,ct;(function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"})(Et||(Et={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(ct||(ct={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.4.33"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */function c(e,t,s,i){if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?i:s==="a"?i.call(e):i?i.value:t.get(e)}function M(e,t,s,i,r){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}const _t=e=>e&&typeof e=="object"&&typeof e.then=="function",It=(async()=>{})().constructor;class _e extends It{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){this._task=t;let s;_t(t)?s=t:typeof t=="function"&&(s=new It(t)),s&&(async()=>{try{const i=await s;t===this._task&&this.resolve(i)}catch(i){t===this._task&&this.reject(i)}})()}get isEmpty(){return this._task==null}constructor(t){let s,i;const r=(n,a)=>{s=n,i=a};super(r),this._s="pending",this.resolve=n=>{this.isPending&&(_t(n)?this.task=n:(this._s="fulfilled",s(n)))},this.reject=n=>{this.isPending&&(this._s="rejected",i(n))},this.task=t}}class Es{constructor(t){this._cvr=t}async getMaxBufferedItems(){return await new Promise((t,s)=>{let i=N();h[i]=async r=>{if(r.success)return t(r.count);{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,s(n)}},f.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(t){return await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s();{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_setMaxBufferedItems",id:r,instanceID:this._cvr._instanceID,body:{count:t}})})}async getBufferedCharacterItemSet(){return await new Promise((t,s)=>{let i=N();h[i]=async r=>{if(r.success)return t(r.itemSet);{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,s(n)}},f.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})}}var cs={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesReceived:!1};const lt=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet){if(t.isDce||t.isFilter){e._irrRegistryState.onTaskResultsReceivedForDce=!0;continue}for(let s in t)e._irrRegistryState[s]||(e._irrRegistryState[s]=!!t[s])}};class _s{constructor(t){this._irrRegistryState=cs,this._intermediateResultReceiverSet=new Set,this._cvr=t}async addResultReceiver(t){if(typeof t!="object")throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(t),lt(this);let s=-1,i={};if(!t.isDce&&!t.isFilter){if(!t._observedResultUnitTypes||!t._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");s=t._observedResultUnitTypes,t._observedTaskMap.forEach((r,n)=>{i[n]=r}),t._observedTaskMap.clear()}return await new Promise((r,n)=>{let a=N();h[a]=async E=>{if(E.success)return r();{let o=new Error(E.message);return o.stack=E.stack+`
`+o.stack,n(o)}},f.postMessage({type:"cvr_setIrrRegistry",id:a,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:s.toString(),observedTaskMap:i}})})}async removeResultReceiver(t){return this._intermediateResultReceiverSet.delete(t),lt(this),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s();{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_setIrrRegistry",id:r,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr._dsImage}}const Pt=typeof self>"u",Ut=typeof importScripts=="function",He=(()=>{if(!Ut){if(!Pt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),kt=e=>{if(e==null&&(e="./"),!(Pt||Ut)){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var me;d.engineResourcePaths.cvr={version:"2.4.33",path:He,isInternal:!0};ee.cvr={js:!0,wasm:!0,deps:["license","dip"]};P.cvr={};const pe="1.4.21";typeof d.engineResourcePaths.std!="string"&&te(d.engineResourcePaths.std.version,pe)<0&&(d.engineResourcePaths.std={version:pe,path:kt(He+`../../dynamsoft-capture-vision-std@${pe}/dist/`),isInternal:!0});const Me="2.4.31";(!d.engineResourcePaths.dip||typeof d.engineResourcePaths.dip!="string"&&te(d.engineResourcePaths.dip.version,Me)<0)&&(d.engineResourcePaths.dip={version:Me,path:kt(He+`../../dynamsoft-image-processing@${Me}/dist/`),isInternal:!0});`${(me=q.cvr)===null||me===void 0?void 0:me.worker}`;const se={barcodeResultItems:{type:S.CRIT_BARCODE,reveiver:"onDecodedBarcodesReceived",isNeedFilter:!0},textLineResultItems:{type:S.CRIT_TEXT_LINE,reveiver:"onRecognizedTextLinesReceived",isNeedFilter:!0},detectedQuadResultItems:{type:S.CRIT_DETECTED_QUAD,reveiver:"onDetectedQuadsReceived",isNeedFilter:!1},normalizedImageResultItems:{type:S.CRIT_NORMALIZED_IMAGE,reveiver:"onNormalizedImagesReceived",isNeedFilter:!1},parsedResultItems:{type:S.CRIT_PARSED_RESULT,reveiver:"onParsedResultsReceived",isNeedFilter:!1}};var De;(function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"})(De||(De={}));function bt(e,t){if(e&&e.location){const s=e.location.points;for(let i of s)i.x=i.x/t,i.y=i.y/t;bt(e.referencedItem,t)}}function m(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}var R,W,k,F,ie,b,$,H,G,Q,re,Ie;const dt={onTaskResultsReceived:()=>{},isFilter:!0};class C{constructor(){this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(d.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,R.set(this,null),W.set(this,null),k.set(this,null),F.set(this,null),ie.set(this,null),b.set(this,new Set),$.set(this,new Set),H.set(this,new Set),G.set(this,0),Q.set(this,!1),re.set(this,!1),Ie.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return c(this,Ie,"f")}static async createInstance(){if(!P.license)throw Error("Module `license` is not existed.");await P.license.dynamsoft(),await j(["cvr"]);const t=new C,s=new _e;let i=N();return h[i]=async r=>{var n;if(r.success)t._instanceID=r.instanceID,t._currentSettings=JSON.parse(JSON.parse(r.outputSettings).data),`${(n=q.cvr)===null||n===void 0?void 0:n.worker}${r.version}`,M(t,re,!0),M(t,F,t.getIntermediateResultManager()),M(t,re,!1),s.resolve(t);else{const a=Error(r.message);r.stack&&(a.stack=r.stack),s.reject(a)}},f.postMessage({type:"cvr_createInstance",id:i}),s}async _singleFrameModeCallback(t){for(let n of c(this,b,"f"))this._isOutputOriginalImage&&n.onOriginalImageResultReceived&&n.onOriginalImageResultReceived({imageData:t});const s={bytes:new Uint8Array(t.bytes),width:t.width,height:t.height,stride:t.stride,format:t.format,tag:t.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(s,this._templateName);i.originalImageTag=t.tag;const r={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let n of c(this,b,"f")){if(n.isDce){n.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});continue}for(let a in se){const E=a,o=se[E];n[o.reveiver]&&i[E]&&n[o.reveiver](Object.assign(Object.assign({},r),{[E]:i[E]}))}n.onCapturedResultReceived&&n.onCapturedResultReceived(i)}}setInput(t){if(m(this),!t){M(this,R,null);return}if(M(this,R,t),t.isCameraEnhancer){c(this,F,"f")&&(c(this,R,"f")._intermediateResultReceiver.isDce=!0,c(this,F,"f").addResultReceiver(c(this,R,"f")._intermediateResultReceiver));const s=c(this,R,"f").getCameraView();if(s){const i=s._capturedResultReceiver;i.isDce=!0,c(this,b,"f").add(i)}}}getInput(){return c(this,R,"f")}addImageSourceStateListener(t){if(m(this),typeof t!="object")return console.warn("Invalid ISA state listener.");!t||!Object.keys(t)||c(this,$,"f").add(t)}removeImageSourceStateListener(t){return m(this),c(this,$,"f").delete(t)}addResultReceiver(t){if(m(this),typeof t!="object")throw new Error("Invalid receiver.");!t||!Object.keys(t).length||(c(this,b,"f").add(t),this._setCrrRegistry())}removeResultReceiver(t){m(this),c(this,b,"f").delete(t),this._setCrrRegistry()}async _setCrrRegistry(){const t={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let r of c(this,b,"f"))r.isDce||(t.onCapturedResultReceived=!!r.onCapturedResultReceived,t.onDecodedBarcodesReceived=!!r.onDecodedBarcodesReceived,t.onRecognizedTextLinesReceived=!!r.onRecognizedTextLinesReceived,t.onDetectedQuadsReceived=!!r.onDetectedQuadsReceived,t.onNormalizedImagesReceived=!!r.onNormalizedImagesReceived,t.onParsedResultsReceived=!!r.onParsedResultsReceived);const s=new _e;let i=N();return h[i]=async r=>{if(r.success)s.resolve();else{let n=new Error(r.message);n.stack=r.stack+`
`+n.stack,s.reject()}},f.postMessage({type:"cvr_setCrrRegistry",id:i,instanceID:this._instanceID,body:{receiver:JSON.stringify(t)}}),s}async addResultFilter(t){if(m(this),!t||typeof t!="object"||!Object.keys(t).length)return console.warn("Invalid filter.");c(this,H,"f").add(t),t._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(t){m(this),c(this,H,"f").delete(t),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(c(this,F,"f").removeResultReceiver(dt),c(this,H,"f").size===0){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const t={[S.CRIT_BARCODE]:!1,[S.CRIT_TEXT_LINE]:!1,[S.CRIT_DETECTED_QUAD]:!1,[S.CRIT_NORMALIZED_IMAGE]:!1},s={[S.CRIT_BARCODE]:!1,[S.CRIT_TEXT_LINE]:!1,[S.CRIT_DETECTED_QUAD]:!1,[S.CRIT_NORMALIZED_IMAGE]:!1};await ut(this,t),await Rt(this,s);return}for(let t of c(this,H,"f"))this._isOpenBarcodeVerify=t.isResultCrossVerificationEnabled(S.CRIT_BARCODE),this._isOpenLabelVerify=t.isResultCrossVerificationEnabled(S.CRIT_TEXT_LINE),this._isOpenDetectVerify=t.isResultCrossVerificationEnabled(S.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=t.isResultCrossVerificationEnabled(S.CRIT_NORMALIZED_IMAGE),t.isLatestOverlappingEnabled(S.CRIT_BARCODE)&&([...c(this,F,"f")._intermediateResultReceiverSet.values()].find(i=>i.isFilter)||c(this,F,"f").addResultReceiver(dt)),await ut(this,t.verificationEnabled),await Rt(this,t.duplicateFilterEnabled),await Is(this,t.duplicateForgetTime)}async startCapturing(t){var s,i;if(m(this),!this._isPauseScan)return;if(!c(this,R,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");t||(t=C._defaultTemplate);const r=await this.containsTask(t);await j(r);for(let a of c(this,H,"f"))await this.addResultFilter(a);if(r.includes("dlr")&&!(!((s=P.dlr)===null||s===void 0)&&s.bLoadConfusableCharsData)){const a=he(d.engineResourcePaths);await((i=P.dlr)===null||i===void 0?void 0:i.loadRecognitionData("ConfusableChars",a.dlr))}if(c(this,R,"f").isCameraEnhancer&&(r.includes("ddn")?c(this,R,"f").setPixelFormat(Ce.IPF_ABGR_8888):c(this,R,"f").setPixelFormat(Ce.IPF_GRAYSCALED)),c(this,R,"f").singleFrameMode!==void 0&&c(this,R,"f").singleFrameMode!=="disabled"){this._templateName=t,c(this,R,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind);return}return c(this,R,"f").getColourChannelUsageType()===ne.CCUT_AUTO&&c(this,R,"f").setColourChannelUsageType(r.includes("ddn")?ne.CCUT_FULL_CHANNEL:ne.CCUT_Y_CHANNEL_ONLY),c(this,k,"f")&&c(this,k,"f").isPending?c(this,k,"f"):(M(this,k,new _e((a,E)=>{if(this.disposed)return;let o=N();h[o]=async l=>{if(!(!c(this,k,"f")||c(this,k,"f").isFulfilled))if(l.success)this._isPauseScan=!1,this._isOutputOriginalImage=l.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&c(this,R,"f").startFetching(),this._loopReadVideo(t),a()},0);else{let I=new Error(l.message);return I.stack=l.stack+`
`+I.stack,E(I)}},f.postMessage({type:"cvr_startCapturing",id:o,instanceID:this._instanceID,body:{templateName:t}})})),await c(this,k,"f"))}stopCapturing(){if(m(this),!!c(this,R,"f")){if(c(this,R,"f").isCameraEnhancer&&c(this,R,"f").singleFrameMode!==void 0&&c(this,R,"f").singleFrameMode!=="disabled"){c(this,R,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind);return}ls(this),c(this,R,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,M(this,k,null),c(this,R,"f").setColourChannelUsageType(ne.CCUT_AUTO)}}async containsTask(t){return m(this),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s(JSON.parse(n.tasks));{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_containsTask",id:r,instanceID:this._instanceID,body:{templateName:t}})})}async _loopReadVideo(t){if(this.disposed||this._isPauseScan)return;if(M(this,Q,!0),c(this,R,"f").isBufferEmpty()){if(c(this,R,"f").hasNextImageToFetch())for(let i of c(this,$,"f"))i.onImageSourceStateReceived&&i.onImageSourceStateReceived(De.ISS_BUFFER_EMPTY);else if(!c(this,R,"f").hasNextImageToFetch())for(let i of c(this,$,"f"))i.onImageSourceStateReceived&&i.onImageSourceStateReceived(De.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||c(this,R,"f").isBufferEmpty())try{c(this,R,"f").isBufferEmpty()&&C._onLog&&C._onLog("buffer is empty so fetch image"),C._onLog&&C._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=c(this,R,"f").fetchImage(),C._onLog&&C._onLog(`DCE: finish fetching a frame: ${Date.now()}`),c(this,R,"f").setImageFetchInterval(this._averageTime)}catch{this._reRunCurrnetFunc(t);return}else if(c(this,R,"f").setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=c(this,R,"f").getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200){this._reRunCurrnetFunc(t);return}if(!this._dsImage){this._reRunCurrnetFunc(t);return}for(let i of c(this,b,"f"))this._isOutputOriginalImage&&i.onOriginalImageResultReceived&&i.onOriginalImageResultReceived({imageData:this._dsImage});const s=Date.now();this._captureDsimage(this._dsImage,t).then(async i=>{if(C._onLog&&C._onLog(`no js handle time: ${Date.now()-s}`),this._isPauseScan){this._reRunCurrnetFunc(t);return}i.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;const r={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let a of c(this,b,"f")){if(a.isDce){const E=Date.now();if(a.onCapturedResultReceived(i,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify}),C._onLog){const o=Date.now()-E;o>10&&C._onLog(`draw result time: ${o}`)}continue}for(let E in se){const o=E,l=se[o];a[l.reveiver],a[l.reveiver]&&i[o]&&a[l.reveiver](Object.assign(Object.assign({},r),{[o]:i[o].filter(I=>!l.isNeedFilter||!I.isFilter)})),i[o]&&(i[o]=i[o].filter(I=>!l.isNeedFilter||!I.isFilter))}a.onCapturedResultReceived&&(i.items=i.items.filter(E=>[S.CRIT_DETECTED_QUAD,S.CRIT_NORMALIZED_IMAGE].includes(E.type)||!E.isFilter),a.onCapturedResultReceived(i))}const n=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-s),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,C._onLog&&(C._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),C._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),C._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),C._onLog(`averageTime: ${this._averageTime}`))),C._onLog){const a=Date.now()-n;a>10&&C._onLog(`fetch image calculate time: ${a}`)}C._onLog&&C._onLog(`time finish decode: ${Date.now()}`),C._onLog&&C._onLog(`main time: ${Date.now()-s}`),C._onLog&&C._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,0))}).catch(i=>{c(this,R,"f").stopFetching(),i.errorCode&&i.errorCode===0&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{c(this,R,"f").startFetching(),this._loopReadVideo(t)},Math.max(this._minImageCaptureInterval,1e3))),i.message!=="platform error"&&setTimeout(()=>{throw i},0)})}_reRunCurrnetFunc(t){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(t)},0)}async capture(t,s){var i,r;m(this),s||(s=C._defaultTemplate);const n=await this.containsTask(s);if(await j(n),n.includes("dlr")&&!(!((i=P.dlr)===null||i===void 0)&&i.bLoadConfusableCharsData)){const E=he(d.engineResourcePaths);await((r=P.dlr)===null||r===void 0?void 0:r.loadRecognitionData("ConfusableChars",E.dlr))}let a;if(M(this,Q,!1),ts(t))a=await this._captureDsimage(t,s);else if(typeof t=="string")t.substring(0,11)=="data:image/"?a=await this._captureBase64(t,s):a=await this._captureUrl(t,s);else if(t instanceof Blob)a=await this._captureBlob(t,s);else if(t instanceof HTMLImageElement)a=await this._captureImage(t,s);else if(t instanceof HTMLCanvasElement)a=await this._captureCanvas(t,s);else if(t instanceof HTMLVideoElement)a=await this._captureVideo(t,s);else throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");return a}async _captureDsimage(t,s){return await this._captureInWorker(t,s)}async _captureUrl(t,s){let i=await qe(t,"blob");return await this._captureBlob(i,s)}async _captureBase64(t,s){t=t.substring(t.indexOf(",")+1);let i=atob(t),r=i.length,n=new Uint8Array(r);for(;r--;)n[r]=i.charCodeAt(r);return await this._captureBlob(new Blob([n]),s)}async _captureBlob(t,s){const i=async function(E){return await new Promise((o,l)=>{let I=URL.createObjectURL(E),g=new Image;g.src=I,g.onload=()=>{URL.revokeObjectURL(g.dbrObjUrl),o(g)},g.onerror=L=>{l(new Error("Can't convert blob to image : "+(L instanceof Event?L.type:L)))}})};let r=null,n=null;if(typeof createImageBitmap<"u")try{r=await createImageBitmap(t)}catch{}r||(n=await i(t));let a=await this._captureImage(r||n,s);return r&&r.close(),a}async _captureImage(t,s){let i=t instanceof HTMLImageElement?t.naturalWidth:t.width,r=t instanceof HTMLImageElement?t.naturalHeight:t.height,n=Math.max(i,r),a,E;n>this.maxImageSideLength?(M(this,G,this.maxImageSideLength/n),a=Math.round(i*c(this,G,"f")),E=Math.round(r*c(this,G,"f"))):(a=i,E=r),c(this,W,"f")||M(this,W,document.createElement("canvas"));const o=c(this,W,"f");return(o.width!==a||o.height!==E)&&(o.width=a,o.height=E),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(t,0,0,i,r,0,0,a,E),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),await this._captureCanvas(o,s)}async _captureCanvas(t,s){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";if([t.width,t.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=t.ctx2d||t.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,t.width,t.height).data),width:t.width,height:t.height,stride:t.width*4,format:10};return await this._captureInWorker(n,s)}async _captureVideo(t,s){if(t.crossOrigin&&t.crossOrigin!="anonymous")throw"cors";let i=t.videoWidth,r=t.videoHeight,n=Math.max(i,r),a,E;n>this.maxImageSideLength?(M(this,G,this.maxImageSideLength/n),a=Math.round(i*c(this,G,"f")),E=Math.round(r*c(this,G,"f"))):(a=i,E=r),c(this,W,"f")||M(this,W,document.createElement("canvas"));const o=c(this,W,"f");return(o.width!==a||o.height!==E)&&(o.width=a,o.height=E),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(t,0,0,i,r,0,0,a,E),await this._captureCanvas(o,s)}async _captureInWorker(t,s){const{bytes:i,width:r,height:n,stride:a,format:E}=t;let o=N();const l=new _e;return h[o]=async I=>{var g,L;if(I.success){const T=Date.now();C._onLog&&(C._onLog(`get result time from worker: ${T}`),C._onLog(`worker to main time consume: ${T-I.workerReturnMsgTime}`));try{const _=I.captureResult;if(_.errorCode!==0){let u=new Error(_.errorString);return u.errorCode=_.errorCode,l.reject(u)}t.bytes=I.bytes;for(let u of _.items)c(this,G,"f")!==0&&bt(u,c(this,G,"f")),u.type===S.CRIT_ORIGINAL_IMAGE?u.imageData=t:u.type===S.CRIT_NORMALIZED_IMAGE?(g=P.ddn)===null||g===void 0||g.handleNormalizedImageResultItem(u):u.type===S.CRIT_PARSED_RESULT&&((L=P.dcp)===null||L===void 0||L.handleParsedResultItem(u));if(c(this,Q,"f"))for(let u of c(this,H,"f"))u.onDecodedBarcodesReceived(_),u.onRecognizedTextLinesReceived(_),u.onDetectedQuadsReceived(_),u.onNormalizedImagesReceived(_);for(let u in se){const U=u,D=_.items.filter(O=>O.type===se[U].type);D.length&&(_[u]=D)}if(!this._isPauseScan||!c(this,Q,"f")){const u=_.intermediateResult;if(u){let U=0;for(let D of c(this,F,"f")._intermediateResultReceiverSet){U++;for(let O of u){if(O.info.callbackName==="onTaskResultsReceived"){for(let y of O.intermediateResultUnits)y.originalImageTag=t.tag?t.tag:null;D[O.info.callbackName]&&D[O.info.callbackName]({intermediateResultUnits:O.intermediateResultUnits},O.info)}else D[O.info.callbackName]&&D[O.info.callbackName](O.result,O.info);U===c(this,F,"f")._intermediateResultReceiverSet.size&&delete O.info.callbackName}}}}return _&&_.hasOwnProperty("intermediateResult")&&delete _.intermediateResult,M(this,G,0,"f"),l.resolve(_)}catch(_){return l.reject(_)}}else{let T=new Error(I.message);return T.stack=I.stack+`
`+T.stack,l.reject(T)}},C._onLog&&C._onLog(`send buffer to worker: ${Date.now()}`),f.postMessage({type:"cvr_capture",id:o,instanceID:this._instanceID,body:{bytes:i,width:r,height:n,stride:a,format:E,templateName:s||"",isScanner:c(this,Q,"f")}},[i.buffer]),l}async initSettings(t){return m(this),!t||!["string","object"].includes(typeof t)?console.error("Invalid template."):(typeof t=="string"?t.trimStart().startsWith("{")||(t=await qe(t,"text")):typeof t=="object"&&(t=JSON.stringify(t)),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success){const a=JSON.parse(n.response);if(a.errorCode!==0){let I=new Error(a.errorString?a.errorString:"Init Settings Failed.");return I.errorCode=a.errorCode,i(I)}const E=JSON.parse(t);this._currentSettings=E;let o=[],l=E.CaptureVisionTemplates;for(let I=0;I<l.length;I++){let g=await this.containsTask(l[I].Name);o=o.concat(g)}return await j([...new Set(o)]),this._isOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,C._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,s(a)}else{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_initSettings",id:r,instanceID:this._instanceID,body:{settings:t}})}))}async outputSettings(t){return m(this),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success){const a=JSON.parse(n.response);if(a.errorCode!==0){let E=new Error(a.errorString);return E.errorCode=a.errorCode,i(E)}return s(JSON.parse(a.data))}else{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_outputSettings",id:r,instanceID:this._instanceID,body:{templateName:t||"*"}})})}async outputSettingsToFile(t,s,i){const r=await this.outputSettings(t),n=new Blob([JSON.stringify(r,null,2,function(a,E){return E instanceof Array?JSON.stringify(E):E},2)],{type:"application/json"});if(i){const a=document.createElement("a");a.href=URL.createObjectURL(n),s.endsWith(".json")&&(s=s.replace(".json","")),a.download=`${s}.json`,a.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(a.href)},500)},a.click()}return n}async getTemplateNames(){return m(this),await new Promise((t,s)=>{let i=N();h[i]=async r=>{if(r.success){const n=JSON.parse(r.response);if(n.errorCode!==0){let a=new Error(n.errorString);return a.errorCode=n.errorCode,s(a)}return t(JSON.parse(n.data))}else{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,s(n)}},f.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})})}async getSimplifiedSettings(t){m(this),t||(t=this._currentSettings.CaptureVisionTemplates[0].Name);const s=await this.containsTask(t);return await j(s),await new Promise((i,r)=>{let n=N();h[n]=async a=>{if(a.success){const E=JSON.parse(a.response);if(E.errorCode!==0){let l=new Error(E.errorString);return l.errorCode=E.errorCode,r(l)}const o=JSON.parse(E.data,(l,I)=>l==="barcodeFormatIds"?BigInt(I):I);return o.minImageCaptureInterval=this._minImageCaptureInterval,i(o)}else{let E=new Error(a.message);return E.stack=a.stack+`
`+E.stack,r(E)}},f.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:t}})})}async updateSettings(t,s){m(this);const i=await this.containsTask(t);return await j(i),await new Promise((r,n)=>{let a=N();h[a]=async E=>{if(E.success){const o=JSON.parse(E.response);if(s.minImageCaptureInterval&&s.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=s.minImageCaptureInterval),this._isOutputOriginalImage=E.isOutputOriginalImage,o.errorCode!==0){let l=new Error(o.errorString?o.errorString:"Update Settings Failed.");return l.errorCode=o.errorCode,n(l)}return this._currentSettings=await this.outputSettings("*"),r(o)}else{let o=new Error(E.message);return o.stack=E.stack+`
`+o.stack,n(o)}},f.postMessage({type:"cvr_updateSettings",id:a,instanceID:this._instanceID,body:{settings:s,templateName:t}})})}async resetSettings(){return m(this),await new Promise((t,s)=>{let i=N();h[i]=async r=>{if(r.success){const n=JSON.parse(r.response);if(n.errorCode!==0){let a=new Error(n.errorString?n.errorString:"Reset Settings Failed.");return a.errorCode=n.errorCode,s(a)}return this._currentSettings=await this.outputSettings("*"),t(n)}else{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,s(n)}},f.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})}getBufferedItemsManager(){return c(this,ie,"f")||M(this,ie,new Es(this)),c(this,ie,"f")}getIntermediateResultManager(){if(m(this),!c(this,re,"f")&&d.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return c(this,F,"f")||M(this,F,new _s(this)),c(this,F,"f")}async parseRequiredResources(t){return m(this),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s(JSON.parse(n.resources));{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_parseRequiredResources",id:r,instanceID:this._instanceID,body:{templateName:t}})})}async dispose(){m(this),c(this,k,"f")&&this.stopCapturing(),M(this,R,null),c(this,b,"f").clear(),c(this,$,"f").clear(),c(this,H,"f").clear(),c(this,F,"f")._intermediateResultReceiverSet.clear(),M(this,Ie,!0);let t=N();h[t]=s=>{if(!s.success){let i=new Error(s.message);throw i.stack=s.stack+`
`+i.stack,i}},f.postMessage({type:"cvr_dispose",id:t,instanceID:this._instanceID})}_getInternalData(){return{isa:c(this,R,"f"),promiseStartScan:c(this,k,"f"),intermediateResultManager:c(this,F,"f"),bufferdItemsManager:c(this,ie,"f"),resultReceiverSet:c(this,b,"f"),isaStateListenerSet:c(this,$,"f"),resultFilterSet:c(this,H,"f"),compressRate:c(this,G,"f"),canvas:c(this,W,"f"),isScanner:c(this,Q,"f"),innerUseTag:c(this,re,"f"),isDestroyed:c(this,Ie,"f")}}async _getWasmFilterState(){return await new Promise((t,s)=>{let i=N();h[i]=async r=>{if(r.success){const n=JSON.parse(r.response);return t(n)}else{let n=new Error(r.message);return n.stack=r.stack+`
`+n.stack,s(n)}},f.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})})}}R=new WeakMap,W=new WeakMap,k=new WeakMap,F=new WeakMap,ie=new WeakMap,b=new WeakMap,$=new WeakMap,H=new WeakMap,G=new WeakMap,Q=new WeakMap,re=new WeakMap,Ie=new WeakMap;C._defaultTemplate="Default";async function ut(e,t){return m(e),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s(n.result);{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_enableResultCrossVerification",id:r,instanceID:e._instanceID,body:{verificationEnabled:t}})})}async function Rt(e,t){return m(e),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s(n.result);{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_enableResultDeduplication",id:r,instanceID:e._instanceID,body:{duplicateFilterEnabled:t}})})}async function Is(e,t){return m(e),await new Promise((s,i)=>{let r=N();h[r]=async n=>{if(n.success)return s(n.result);{let a=new Error(n.message);return a.stack=n.stack+`
`+a.stack,i(a)}},f.postMessage({type:"cvr_setDuplicateForgetTime",id:r,instanceID:e._instanceID,body:{duplicateForgetTime:t}})})}async function ls(e){let t=N();const s=new _e;return h[t]=async i=>{if(i.success)return s.resolve();{let r=new Error(i.message);return r.stack=i.stack+`
`+r.stack,s.reject(r)}},f.postMessage({type:"cvr_clearVerifyList",id:t,instanceID:e._instanceID}),s}var ft;(function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadBarcodes_Balanced",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"})(ft||(ft={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.31
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const z=typeof self>"u",Ct=z?{}:self,Gt=typeof importScripts=="function",Vt=(()=>{if(!Gt){if(!z&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),ds=e=>{if(e==null&&(e="./"),!(z||Gt)){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},Tt=e=>e&&typeof e=="object"&&typeof e.then=="function",ht=(async()=>{})().constructor;let We=class extends ht{get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(t){let s;this._task=t,Tt(t)?s=t:typeof t=="function"&&(s=new ht(t)),s&&(async()=>{try{const i=await s;t===this._task&&this.resolve(i)}catch(i){t===this._task&&this.reject(i)}})()}get isEmpty(){return this._task==null}constructor(t){let s,i;super((r,n)=>{s=r,i=n}),this._s="pending",this.resolve=r=>{this.isPending&&(Tt(r)?this.task=r:(this._s="fulfilled",s(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",i(r))},this.task=t}};const Ae=" is not allowed to change after `createInstance` or `loadWasm` is called.",us=!z&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",gt=(e,t)=>{const s=e;if(s._license!==t){if(!s._pLoad.isEmpty)throw new Error("`license`"+Ae);s._license=t}};!z&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const xt=e=>{if(e==null)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!z){let s=document.createElement("a");s.href=e[t],e[t]=s.href}e[t].endsWith("/")||(e[t]+="/")}}return e},Dt=(e,t)=>{t=xt(t);const s=e;if(s._licenseServer!==t){if(!s._pLoad.isEmpty)throw new Error("`licenseServer`"+Ae);s._licenseServer=t}},At=(e,t)=>{t=t||"";const s=e;if(s._deviceFriendlyName!==t){if(!s._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Ae);s._deviceFriendlyName=t}};let Ee,ce,Re,ve,x;typeof navigator<"u"&&(Ee=navigator,ce=Ee.userAgent,Re=Ee.platform,ve=Ee.mediaDevices),function(){if(!z){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ee.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Re,search:"Win"},Mac:{str:Re},Linux:{str:Re}};let s="unknownBrowser",i=0,r="unknownOS";for(let n in e){const a=e[n]||{};let E=a.str||ce,o=a.search||n,l=a.verStr||ce,I=a.verSearch||n;if(I instanceof Array||(I=[I]),E.indexOf(o)!=-1){s=n;for(let g of I){let L=l.indexOf(g);if(L!=-1){i=parseFloat(l.substring(L+g.length+1));break}}break}}for(let n in t){const a=t[n]||{};let E=a.str||ce,o=a.search||n;if(E.indexOf(o)!=-1){r=n;break}}r=="Linux"&&ce.indexOf("Windows NT")!=-1&&(r="HarmonyOS"),x={browser:s,version:i,OS:r}}z&&(x={browser:"ssr",version:0,OS:"ssr"})}(),ve&&ve.getUserMedia,x.browser==="Chrome"&&x.version>66||x.browser==="Safari"&&x.version>13||x.browser==="OPR"&&x.version>43||x.browser==="Edge"&&x.version;const Ht=()=>(j("license"),Ve("dynamsoft_inited",async()=>{let{lt:e,l:t,ls:s,sp:i,rmk:r,cv:n}=((o,l=!1)=>{const I=o;if(I._pLoad.isEmpty){let g,L,T,_=I._license||"",u=JSON.parse(JSON.stringify(I._licenseServer)),U=I._sessionPassword,D=0;if(_.startsWith("t")||_.startsWith("f"))D=0;else if(_.length===0||_.startsWith("P")||_.startsWith("L")||_.startsWith("Y")||_.startsWith("A"))D=1;else{D=2;const O=_.indexOf(":");O!=-1&&(_=_.substring(O+1));const y=_.indexOf("?");if(y!=-1&&(L=_.substring(y+1),_=_.substring(0,y)),_.startsWith("DLC2"))D=0;else{if(_.startsWith("DLS2")){let w;try{let V=_.substring(4);V=atob(V),w=JSON.parse(V)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(_=w.handshakeCode?w.handshakeCode:w.organizationID?w.organizationID:"",typeof _=="number"&&(_=JSON.stringify(_)),u.length===0){let V=[];w.mainServerURL&&(V[0]=w.mainServerURL),w.standbyServerURL&&(V[1]=w.standbyServerURL),u=xt(V)}!U&&w.sessionPassword&&(U=w.sessionPassword),g=w.remark}_&&_!=="200001"&&!_.startsWith("200001-")||(D=1)}}if(D&&(l||(Ct.crypto||(T="Please upgrade your browser to support online key."),Ct.crypto.subtle||(T="Require https to use online key in this browser."))),T)throw new Error(T);return D===1&&(_="",console.warn("Applying for a public trial license ...")),{lt:D,l:_,ls:u,sp:U,rmk:g,cv:L}}throw new Error("Can't preprocess license again"+Ae)})(v),a=new We;v._pLoad.task=a,(async()=>{try{await v._pLoad}catch{}})();let E=N();h[E]=o=>{if(o.message&&v._onAuthMessage){let g=v._onAuthMessage(o.message);g!=null&&(o.message=g)}let l,I=!1;if(e===1&&(I=!0),o.success?(J&&J("init license success"),o.message&&console.warn(o.message),d._bSupportIRTModule=o.bSupportIRTModule,d._bSupportDce4Module=o.bSupportDce4Module,v.bPassValidation=!0,[0,-10076].includes(o.initLicenseInfo.errorCode)?[-10076].includes(o.initLicenseInfo.errorCode)&&console.warn(o.initLicenseInfo.errorString):a.reject(new Error(o.initLicenseInfo.errorString))):(l=Error(o.message),o.stack&&(l.stack=o.stack),o.ltsErrorCode&&(l.ltsErrorCode=o.ltsErrorCode),I||o.ltsErrorCode==111&&o.message.toLowerCase().indexOf("trial license")!=-1&&(I=!0)),I){const g=he(d.engineResourcePaths);(async(L,T,_)=>{if(!L._bNeverShowDialog)try{let u=await fetch(L.engineResourcePath+"dls.license.dialog.html");if(!u.ok)throw Error("Get license dialog fail. Network Error: "+u.statusText);let U=await u.text();if(!U.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let D=document.createElement("div");D.innerHTML=U;let O=[];for(let A=0;A<D.childElementCount;++A){let p=D.children[A];p instanceof HTMLStyleElement&&(O.push(p),document.head.append(p))}let y=D.childElementCount==1?D.children[0]:D;y.remove();let w,V,Ze,Xe,$e,ae=[y],Qt=y.children;for(let A of Qt)ae.push(A);for(let A=0;A<ae.length;++A)for(let p of ae[A].children)ae.push(p);for(let A of ae)if(!w&&A.classList.contains("dls-license-mask"))w=A,A.addEventListener("click",p=>{if(A==p.target){y.remove();for(let K of O)K.remove()}});else if(!V&&A.classList.contains("dls-license-icon-close"))V=A,A.addEventListener("click",()=>{y.remove();for(let p of O)p.remove()});else if(!Ze&&A.classList.contains("dls-license-icon-error"))Ze=A,T!="error"&&A.remove();else if(!Xe&&A.classList.contains("dls-license-icon-warn"))Xe=A,T!="warn"&&A.remove();else if(!$e&&A.classList.contains("dls-license-msg-content")){$e=A;let p=_;for(;p;){let K=p.indexOf("["),Ne=p.indexOf("]",K),Se=p.indexOf("(",Ne),Le=p.indexOf(")",Se);if(K==-1||Ne==-1||Se==-1||Le==-1){A.appendChild(new Text(p));break}K>0&&A.appendChild(new Text(p.substring(0,K)));let le=document.createElement("a"),Jt=p.substring(K+1,Ne);le.innerText=Jt;let zt=p.substring(Se+1,Le);le.setAttribute("href",zt),le.setAttribute("target","_blank"),A.appendChild(le),p=p.substring(Le+1)}}document.body.appendChild(y)}catch(u){L._onLog&&L._onLog(u.message||u)}})({_bNeverShowDialog:v._bNeverShowDialog,engineResourcePath:g.license,_onLog:J},o.success?"warn":"error",o.message)}o.success?a.resolve(void 0):a.reject(l)},await Ue("core"),f.postMessage({type:"license_dynamsoft",body:{v:"3.4.31",brtk:!!e,bptk:e===1,l:t,os:x,fn:v.deviceFriendlyName,ls:s,sp:i,rmk:r,cv:n},id:E}),v.bCallInitLicense=!0,await a}));let Nt;P.license={},P.license.dynamsoft=Ht,P.license.getAR=async()=>{{let e=X.dynamsoft_inited;e&&e.isRejected&&await e}return f?new Promise((e,t)=>{let s=N();h[s]=async i=>{if(i.success){delete i.success;{let r=v.license;r&&(r.startsWith("t")||r.startsWith("f"))&&(i.pk=r)}if(Object.keys(i).length){if(i.lem){let r=Error(i.lem);r.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=r}e(i)}else e(null)}else{let r=Error(i.message);i.stack&&(r.stack=i.stack),t(r)}},f.postMessage({type:"license_getAR",id:s})}):null};let v=class Y{static setLicenseServer(t){Dt(Y,t)}static get license(){return this._license}static set license(t){gt(Y,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){Dt(Y,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){At(Y,t)}static initLicense(t,s){if(gt(Y,t),Y.bCallInitLicense=!0,typeof s=="boolean"&&s||typeof s=="object"&&s.executeNow)return Ht()}static setDeviceFriendlyName(t){At(Y,t)}static getDeviceFriendlyName(){return Y._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await Ve("dynamsoft_uuid",async()=>{await j();let t=new We,s=N();h[s]=i=>{if(i.success)t.resolve(i.uuid);else{const r=Error(i.message);i.stack&&(r.stack=i.stack),t.reject(r)}},f.postMessage({type:"license_getDeviceUUID",id:s}),Nt=await t}),Nt))()}};v._pLoad=new We,v.bPassValidation=!1,v.bCallInitLicense=!1,v._license=us,v._licenseServer=[],v._deviceFriendlyName="",d.engineResourcePaths.license={version:"3.4.31",path:Vt,isInternal:!0},ee.license={wasm:!0,js:!0},P.license.LicenseManager=v;const ye="1.4.21";typeof d.engineResourcePaths.std!="string"&&te(d.engineResourcePaths.std.version,ye)<0&&(d.engineResourcePaths.std={version:ye,path:ds(Vt+`../../dynamsoft-capture-vision-std@${ye}/dist/`),isInternal:!0});/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Utility JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 1.4.32
 * @fileoverview Dynamsoft JavaScript Library for Utility
 * More info DU JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/utility/utility-module.html
 */const Wt=typeof self>"u",Yt=typeof importScripts=="function",Ye=(()=>{if(!Yt){if(!Wt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),jt=e=>{if(e==null&&(e="./"),!(Wt||Yt)){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};d.engineResourcePaths.utility={version:"1.4.32",path:Ye,isInternal:!0},ee.utility={js:!0,wasm:!0};const we="1.4.21";typeof d.engineResourcePaths.std!="string"&&te(d.engineResourcePaths.std.version,we)<0&&(d.engineResourcePaths.std={version:we,path:jt(Ye+`../../dynamsoft-capture-vision-std@${we}/dist/`),isInternal:!0});const Fe="2.4.31";(!d.engineResourcePaths.dip||typeof d.engineResourcePaths.dip!="string"&&te(d.engineResourcePaths.dip.version,Fe)<0)&&(d.engineResourcePaths.dip={version:Fe,path:jt(Ye+`../../dynamsoft-image-processing@${Fe}/dist/`),isInternal:!0});BigInt(3147775),BigInt(260096);/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.4.31
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const Zt=typeof self>"u",Xt=typeof importScripts=="function",je=(()=>{if(!Xt){if(!Zt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),$t=e=>{if(e==null&&(e="./"),!(Zt||Xt)){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};d.engineResourcePaths.dbr={version:"10.4.31",path:je,isInternal:!0},ee.dbr={js:!1,wasm:!0,deps:["license","dip"]},P.dbr={};const Be="1.4.21";typeof d.engineResourcePaths.std!="string"&&te(d.engineResourcePaths.std.version,Be)<0&&(d.engineResourcePaths.std={version:Be,path:$t(je+`../../dynamsoft-capture-vision-std@${Be}/dist/`),isInternal:!0});const Pe="2.4.31";(!d.engineResourcePaths.dip||typeof d.engineResourcePaths.dip!="string"&&te(d.engineResourcePaths.dip.version,Pe)<0)&&(d.engineResourcePaths.dip={version:Pe,path:$t(je+`../../dynamsoft-image-processing@${Pe}/dist/`),isInternal:!0});BigInt(0),BigInt("0xFFFFFFFEFFFFFFFF"),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552);var St,Lt,Ot,mt;(function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(St||(St={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Lt||(Lt={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP"}(Ot||(Ot={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP"}(mt||(mt={}));/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition Bundle
* @website http://www.dynamsoft.com
* @copyright Copyright 2025, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.5.3000
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const Rs=typeof self>"u",fs=typeof importScripts=="function";(()=>{if(!fs){if(!Rs&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(t!=-1)e=e.substring(0,t);else{let s=e.indexOf("#");s!=-1&&(e=e.substring(0,s))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})();var be,pt,Mt;(function(e){e[e.SM_SINGLE=0]="SM_SINGLE",e[e.SM_MULTI_UNIQUE=1]="SM_MULTI_UNIQUE"})(be||(be={})),function(e){e[e.OM_NONE=0]="OM_NONE",e[e.OM_SPEED=1]="OM_SPEED",e[e.OM_COVERAGE=2]="OM_COVERAGE",e[e.OM_BALANCE=3]="OM_BALANCE",e[e.OM_DPM=4]="OM_DPM",e[e.OM_DENSE=5]="OM_DENSE"}(pt||(pt={})),function(e){e[e.RS_SUCCESS=0]="RS_SUCCESS",e[e.RS_CANCELLED=1]="RS_CANCELLED",e[e.RS_FAILED=2]="RS_FAILED"}(Mt||(Mt={}));be.SM_SINGLE;(async()=>{})().constructor;C._defaultTemplate="ReadSingleBarcode";class gs{constructor(){Oe(this,"name","Dynamsoft");Oe(this,"reader",null)}async init(){d.engineResourcePaths.rootDirectory="https://cdn.jsdelivr.net/npm/",de.info("DynamsoftProvider","Initializing Dynamsoft provider");try{v.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMTAxNTM1MTE5LVRYbFhaV0pRY205cSIsIm1haW5TZXJ2ZXJVUkwiOiJodHRwczovL21kbHMuZHluYW1zb2Z0b25saW5lLmNvbSIsIm9yZ2FuaXphdGlvbklEIjoiMTAxNTM1MTE5Iiwic3RhbmRieVNlcnZlclVSTCI6Imh0dHBzOi8vc2Rscy5keW5hbXNvZnRvbmxpbmUuY29tIiwiY2hlY2tDb2RlIjoyMDc0NjM0MzZ9",{executeNow:!0}),d.loadWasm(["DBR"]),this.reader=await C.createInstance(),de.debug("DynamsoftProvider","Dynamsoft SDK loaded")}catch(t){throw de.error("DynamsoftProvider","Failed to load Dynamsoft SDK",t),t}}async decodeCanvas(t){if(!this.reader)throw new Error("Dynamsoft provider not initialised");const s=await this.reader.capture(t),i=s.barcodeResultItems.find(n=>n.formatString==="PDF417"),r=s.barcodeResultItems.find(n=>n.formatString==="QR_CODE");return i?i.text:r?r.text:null}async scanVideoFrame(t){if(!this.reader)throw new Error("Dynamsoft provider not initialised");return this.decodeCanvas(t)}async scanImage(t){let s;if(t instanceof HTMLCanvasElement)s=t;else{s=document.createElement("canvas"),s.width=t.naturalWidth||t.width,s.height=t.naturalHeight||t.height;const i=s.getContext("2d");if(!i)throw new Error("Cannot get canvas context");i.drawImage(t,0,0)}return this.decodeCanvas(t)}destroy(){var t,s;de.debug("DynamsoftProvider","Releasing Dynamsoft resources"),(s=(t=this.reader)==null?void 0:t.destroy)==null||s.call(t),this.reader=null}}export{gs as DynamsoftProvider};
